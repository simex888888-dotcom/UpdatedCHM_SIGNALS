"""
keyboards.py â€” ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ğ±Ğ¾Ñ‚Ğ° v4.5
ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ²Ñ‘Ñ€ÑÑ‚ĞºĞ¸:
  â€¢ ĞšĞ°Ğ¶Ğ´Ğ°Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ° â€” Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° [[btn], [btn], ...]
  â€¢ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ â€” Ğ½Ğ¾Ğ½-ĞºĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° _noop() ĞŸĞ•Ğ Ğ•Ğ” ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹
  â€¢ Ğ¢ĞµĞºÑÑ‚ ÑĞ°Ğ¼Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ â€” ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ğ¸ Ñ‡Ñ‘Ñ‚ĞºĞ¸Ğ¹ (Ğ½Ğµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°ĞµÑ‚ÑÑ Telegram)
"""

from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from user_manager import UserSettings, TradeCfg


# â”€â”€ Ğ¥ĞµĞ»Ğ¿ĞµÑ€Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def _btn(text: str, cb: str) -> list:
    """ĞšĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ğ°Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ° â€” Ğ¾Ğ´Ğ½Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞ°."""
    return [InlineKeyboardButton(text=text, callback_data=cb)]

def _back(cb: str = "back_main") -> list:
    return [InlineKeyboardButton(text="â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data=cb)]

def _noop(text: str) -> list:
    """ĞĞ¾Ğ½-ĞºĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ/Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°."""
    return [InlineKeyboardButton(text=text, callback_data="noop")]

def _sep() -> list:
    """Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ."""
    return _noop("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")

def _check(v: bool) -> str:
    return "âœ…" if v else "âŒ"

def _mark(current, val) -> str:
    return "â—‰ " if current == val else "â—‹ "


# â”€â”€ Ğ¢Ñ€ĞµĞ½Ğ´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def trend_text(trend: dict) -> str:
    if not trend:
        return "ğŸŒ <b>Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´:</b> Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...\n"
    btc = trend.get("BTC", {})
    eth = trend.get("ETH", {})
    return (
        "ğŸŒ <b>Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´ (1D):</b>\n"
        + btc.get("emoji", "â“") + " BTC: <b>" + btc.get("trend", "â€”") + "</b>"
        + "   " + eth.get("emoji", "â“") + " ETH: <b>" + eth.get("trend", "â€”") + "</b>\n"
    )


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def kb_main(user: UserSettings) -> InlineKeyboardMarkup:
    long_s  = "ğŸŸ¢" if user.long_active  else "âš«"
    short_s = "ğŸŸ¢" if user.short_active else "âš«"
    both_s  = "ğŸŸ¢" if (user.active and user.scan_mode == "both") else "âš«"
    return InlineKeyboardMarkup(inline_keyboard=[
        _btn(long_s  + " ğŸ“ˆ Ğ›ĞĞĞ“ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸",   "mode_long"),
        _btn(short_s + " ğŸ“‰ Ğ¨ĞĞ Ğ¢ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸",  "mode_short"),
        _btn(both_s  + " âš¡ ĞĞ‘Ğ â€” Ğ»Ğ¾Ğ½Ğ³Ğ¸ Ğ¸ ÑˆĞ¾Ñ€Ñ‚Ñ‹ ÑÑ€Ğ°Ğ·Ñƒ",       "mode_both"),
        _btn("ğŸ“Š ĞœĞ¾Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",                              "my_stats"),
    ])


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ĞœĞ•ĞĞ® Ğ›ĞĞĞ“ / Ğ¨ĞĞ Ğ¢ / ĞĞ‘Ğ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def kb_mode_long(user: UserSettings) -> InlineKeyboardMarkup:
    cfg    = user.get_long_cfg()
    status = "ğŸŸ¢ Ğ›ĞĞĞ“ Ğ’ĞšĞ› â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ" if user.long_active \
           else "ğŸ”´ Ğ›ĞĞĞ“ Ğ’Ğ«ĞšĞ› â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ"
    return InlineKeyboardMarkup(inline_keyboard=[
        _btn(status,                                                "toggle_long"),
        _sep(),
        _noop("ğŸ“Š Ğ¢Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼ â€” Ğ½Ğ° ĞºĞ°ĞºĞ¾Ğ¼ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞµ Ğ¸Ñ‰ĞµĞ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹"),
        _btn("Ğ¢Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼: " + cfg.timeframe,                        "menu_long_tf"),
        _noop("ğŸ”„ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» â€” ĞºĞ°Ğº Ñ‡Ğ°ÑÑ‚Ğ¾ ÑĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ñ‹Ğ½Ğ¾Ğº"),
        _btn("Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»: " + str(cfg.scan_interval // 60) + " Ğ¼Ğ¸Ğ½", "menu_long_interval"),
        _sep(),
        _btn("âš¡ SMC ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°",     "menu_long_smc"),
        _btn("ğŸ“ ĞŸĞ¸Ğ²Ğ¾Ñ‚Ñ‹ Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ S/R",  "menu_long_pivots"),
        _btn("ğŸ“‰ EMA Ñ‚Ñ€ĞµĞ½Ğ´",             "menu_long_ema"),
        _btn("ğŸ”¬ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹",               "menu_long_filters"),
        _btn("â­ ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°",       "menu_long_quality"),
        _btn("ğŸ” Cooldown",              "menu_long_cooldown"),
        _btn("ğŸ›¡ Ğ¡Ñ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ (ATR)",       "menu_long_sl"),
        _btn("ğŸ¯ Take Profit",           "menu_long_targets"),
        _btn("ğŸ’° Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¼Ğ¾Ğ½ĞµÑ‚",          "menu_long_volume"),
        _sep(),
        _btn("ğŸ” Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğº Ğ¾Ğ±Ñ‰Ğ¸Ğ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼", "reset_long_cfg"),
        _back(),
    ])


def kb_mode_short(user: UserSettings) -> InlineKeyboardMarkup:
    cfg    = user.get_short_cfg()
    status = "ğŸŸ¢ Ğ¨ĞĞ Ğ¢ Ğ’ĞšĞ› â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ" if user.short_active \
           else "ğŸ”´ Ğ¨ĞĞ Ğ¢ Ğ’Ğ«ĞšĞ› â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ"
    return InlineKeyboardMarkup(inline_keyboard=[
        _btn(status,                                                 "toggle_short"),
        _sep(),
        _noop("ğŸ“Š Ğ¢Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼ â€” Ğ½Ğ° ĞºĞ°ĞºĞ¾Ğ¼ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞµ Ğ¸Ñ‰ĞµĞ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹"),
        _btn("Ğ¢Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼: " + cfg.timeframe,                         "menu_short_tf"),
        _noop("ğŸ”„ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» â€” ĞºĞ°Ğº Ñ‡Ğ°ÑÑ‚Ğ¾ ÑĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ñ‹Ğ½Ğ¾Ğº"),
        _btn("Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»: " + str(cfg.scan_interval // 60) + " Ğ¼Ğ¸Ğ½",  "menu_short_interval"),
        _sep(),
        _btn("âš¡ SMC ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°",     "menu_short_smc"),
        _btn("ğŸ“ ĞŸĞ¸Ğ²Ğ¾Ñ‚Ñ‹ Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ S/R",  "menu_short_pivots"),
        _btn("ğŸ“‰ EMA Ñ‚Ñ€ĞµĞ½Ğ´",             "menu_short_ema"),
        _btn("ğŸ”¬ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹",               "menu_short_filters"),
        _btn("â­ ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°",       "menu_short_quality"),
        _btn("ğŸ” Cooldown",              "menu_short_cooldown"),
        _btn("ğŸ›¡ Ğ¡Ñ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ (ATR)",       "menu_short_sl"),
        _btn("ğŸ¯ Take Profit",           "menu_short_targets"),
        _btn("ğŸ’° Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¼Ğ¾Ğ½ĞµÑ‚",          "menu_short_volume"),
        _sep(),
        _btn("ğŸ” Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğº Ğ¾Ğ±Ñ‰Ğ¸Ğ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼", "reset_short_cfg"),
        _back(),
    ])


def kb_mode_both(user: UserSettings) -> InlineKeyboardMarkup:
    active = user.active and user.scan_mode == "both"
    status = "ğŸŸ¢ Ğ¡ĞºĞ°Ğ½ĞµÑ€ Ğ’ĞšĞ› â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ" if active \
           else "ğŸ”´ Ğ¡ĞºĞ°Ğ½ĞµÑ€ Ğ’Ğ«ĞšĞ› â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ"
    return InlineKeyboardMarkup(inline_keyboard=[
        _btn(status,                                                    "toggle_both"),
        _sep(),
        _noop("ğŸ“Š Ğ¢Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼ â€” Ğ½Ğ° ĞºĞ°ĞºĞ¾Ğ¼ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞµ Ğ¸Ñ‰ĞµĞ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹"),
        _btn("Ğ¢Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼: " + user.timeframe,                           "menu_tf"),
        _noop("ğŸ”„ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» â€” ĞºĞ°Ğº Ñ‡Ğ°ÑÑ‚Ğ¾ ÑĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ñ‹Ğ½Ğ¾Ğº"),
        _btn("Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»: " + str(user.scan_interval // 60) + " Ğ¼Ğ¸Ğ½",    "menu_interval"),
        _sep(),
        _btn("âš™ï¸ Ğ’ÑĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ â†’",  "menu_settings"),
        _back(),
    ])


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ¢ĞĞ™ĞœĞ¤Ğ Ğ•Ğ™Ğœ / Ğ˜ĞĞ¢Ğ•Ğ Ğ’ĞĞ›
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_TF_DESCS = {
    "1m":  ("1 Ğ¼Ğ¸Ğ½",  "ÑĞºĞ°Ğ»ÑŒĞ¿Ğ¸Ğ½Ğ³ â€” Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ², Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ÑˆÑƒĞ¼"),
    "5m":  ("5 Ğ¼Ğ¸Ğ½",  "ÑĞºĞ°Ğ»ÑŒĞ¿Ğ¸Ğ½Ğ³ â€” Ñ‡ÑƒÑ‚ÑŒ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½ĞµĞµ Ñ‡ĞµĞ¼ 1m"),
    "15m": ("15 Ğ¼Ğ¸Ğ½", "Ğ¸Ğ½Ñ‚Ñ€Ğ°Ğ´ĞµĞ¹ â€” Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ â­"),
    "30m": ("30 Ğ¼Ğ¸Ğ½", "Ğ¸Ğ½Ñ‚Ñ€Ğ°Ğ´ĞµĞ¹ â€” Ğ¼ĞµĞ½ÑŒÑˆĞµ ÑˆÑƒĞ¼Ğ° Ñ‡ĞµĞ¼ 15m"),
    "1h":  ("1 Ñ‡Ğ°Ñ",  "ÑĞ²Ğ¸Ğ½Ğ³ â€” Ñ…Ğ¾Ñ€Ğ¾ÑˆĞµĞµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ R:R â­"),
    "4h":  ("4 Ñ‡Ğ°ÑĞ°", "ÑĞ²Ğ¸Ğ½Ğ³ â€” Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ, Ğ¼Ğ°Ğ»Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²"),
    "1d":  ("1 Ğ´ĞµĞ½ÑŒ", "Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ"),
}

def _tf_rows(current: str, prefix: str, back_cb: str) -> list:
    rows = [_noop("â”€â”€ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ñ‚Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")]
    for tf, (label, desc) in _TF_DESCS.items():
        rows.append(_noop("   " + desc))
        rows.append(_btn(_mark(current, tf) + label, prefix + tf))
    rows.append(_back(back_cb))
    return rows

_INTERVAL_DESCS = {
    300:   ("5 Ğ¼Ğ¸Ğ½",   "Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ€Ñ‹Ğ½Ğ¾Ğº ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½, Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"),
    900:   ("15 Ğ¼Ğ¸Ğ½",  "Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸"),
    1800:  ("30 Ğ¼Ğ¸Ğ½",  "ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾, Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ´ÑƒĞ±Ğ»ĞµĞ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²"),
    3600:  ("1 Ñ‡Ğ°Ñ",   "Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ â€” Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ â­"),
    7200:  ("2 Ñ‡Ğ°ÑĞ°",  "Ğ´Ğ»Ñ Ğ½ĞµÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸"),
    14400: ("4 Ñ‡Ğ°ÑĞ°",  "Ñ€ĞµĞ´ĞºĞ¸Ğµ, ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹"),
    86400: ("1 Ğ´ĞµĞ½ÑŒ",  "Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·"),
}

def _interval_rows(current: int, prefix: str, back_cb: str) -> list:
    rows = [_noop("â”€â”€ ĞšĞ°Ğº Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ Ñ€Ñ‹Ğ½Ğ¾Ğº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")]
    for sec, (label, desc) in _INTERVAL_DESCS.items():
        rows.append(_noop("   " + desc))
        rows.append(_btn(_mark(current, sec) + label, prefix + str(sec)))
    rows.append(_back(back_cb))
    return rows

def kb_timeframes(cur: str, *a)   -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=_tf_rows(cur, "set_tf_", "mode_both"))
def kb_long_timeframes(cur: str)  -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=_tf_rows(cur, "set_long_tf_", "mode_long"))
def kb_short_timeframes(cur: str) -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=_tf_rows(cur, "set_short_tf_", "mode_short"))

def kb_intervals(cur: int)        -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=_interval_rows(cur, "set_interval_", "mode_both"))
def kb_long_intervals(cur: int)   -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=_interval_rows(cur, "set_long_interval_", "mode_long"))
def kb_short_intervals(cur: int)  -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=_interval_rows(cur, "set_short_interval_", "mode_short"))


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ĞœĞ•ĞĞ® ĞĞĞ¡Ğ¢Ğ ĞĞ•Ğš (Ğ¾Ğ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _settings_menu(prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    return InlineKeyboardMarkup(inline_keyboard=[
        _noop("âš™ï¸ ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("â”€â”€ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _btn("âš¡ SMC ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°",           "menu_" + p + "smc"),
        _btn("ğŸ“ ĞŸĞ¸Ğ²Ğ¾Ñ‚Ñ‹ Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ S/R",        "menu_" + p + "pivots"),
        _btn("ğŸ“‰ EMA Ñ‚Ñ€ĞµĞ½Ğ´",                   "menu_" + p + "ema"),
        _btn("ğŸ”¬ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ (RSI / ĞĞ±ÑŠÑ‘Ğ¼ / HTF)", "menu_" + p + "filters"),
        _btn("â­ ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°",             "menu_" + p + "quality"),
        _btn("ğŸ” Cooldown Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°Ğ¼Ğ¸",     "menu_" + p + "cooldown"),
        _noop("â”€â”€ Ğ Ğ¸ÑĞº-Ğ¼ĞµĞ½ĞµĞ´Ğ¶Ğ¼ĞµĞ½Ñ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _btn("ğŸ›¡ Ğ¡Ñ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ (ATR)",             "menu_" + p + "sl"),
        _btn("ğŸ¯ Ğ¦ĞµĞ»Ğ¸ (Take Profit R:R)",       "menu_" + p + "targets"),
        _noop("â”€â”€ ĞœĞ¾Ğ½ĞµÑ‚Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _btn("ğŸ’° Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¼Ğ¾Ğ½ĞµÑ‚ Ğ¿Ğ¾ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ñƒ",       "menu_" + p + "volume"),
        _noop("â”€â”€ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _btn("ğŸ“± Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ",                  "menu_notify"),
        _back(back_cb),
    ])

def kb_settings()       -> InlineKeyboardMarkup: return _settings_menu("",       "mode_both")
def kb_long_settings()  -> InlineKeyboardMarkup: return _settings_menu("long_",  "mode_long")
def kb_short_settings() -> InlineKeyboardMarkup: return _settings_menu("short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  SMC Ğ£Ğ¡Ğ›ĞĞ’Ğ˜Ğ¯
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _smc_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("âš¡ SMC CONDITIONS â€” Ğ²ĞºĞ»ÑÑ‡Ğ°Ğ¹ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ"),
        _noop("ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ğ¾Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°."),
        _sep(),

        _noop("ğŸ“Œ BOS â€” Break of Structure"),
        _noop("   ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹. ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾"),
        _noop("   Ñ€Ñ‹Ğ½Ğ¾Ğº ÑĞ»Ğ¾Ğ¼Ğ°Ğ» Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ñ…Ğ°Ğ¹/Ğ»Ğ¾Ñƒ Ğ¸ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ÑÑŒ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ."),
        _btn(_check(cfg.smc_use_bos) + "  BOS â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "smc_toggle_bos"),
        _sep(),

        _noop("ğŸ“Œ Order Block (OB)"),
        _noop("   Ğ—Ğ¾Ğ½Ğ° Ğ³Ğ´Ğµ ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğ¹ Ğ¸Ğ³Ñ€Ğ¾Ğº Ğ½Ğ°Ğ±Ğ¸Ñ€Ğ°Ğ» Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´"),
        _noop("   ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸ĞµĞ¼. Ğ¦ĞµĞ½Ğ° Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ğ² OB."),
        _btn(_check(cfg.smc_use_ob) + "  Order Block â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "smc_toggle_ob"),
        _sep(),

        _noop("ğŸ“Œ FVG â€” Fair Value Gap"),
        _noop("   Ğ”Ğ¸ÑĞ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ²ĞµÑ‡Ğ°Ğ¼Ğ¸: Ñ€Ñ‹Ğ½Ğ¾Ğº Ğ¿Ñ€Ğ¾ÑˆÑ‘Ğ» Ğ·Ğ¾Ğ½Ñƒ Ñ‚Ğ°Ğº"),
        _noop("   Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» Â«Ğ¿ÑƒÑÑ‚Ğ¾Ñ‚ÑƒÂ» Ğ±ĞµĞ· ÑĞ´ĞµĞ»Ğ¾Ğº."),
        _btn(_check(cfg.smc_use_fvg) + "  FVG â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "smc_toggle_fvg"),
        _sep(),

        _noop("ğŸ“Œ Sweep â€” Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ¹ Ğ»Ğ¸ĞºĞ²Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚Ğ¸"),
        _noop("   Ğ Ñ‹Ğ½Ğ¾Ğº Ğ²Ñ‹Ğ±Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ¾Ğ¿Ñ‹ Ğ²Ñ‹ÑˆĞµ/Ğ½Ğ¸Ğ¶Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¸"),
        _noop("   Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾. Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ°."),
        _btn(_check(cfg.smc_use_sweep) + "  Sweep â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "smc_toggle_sweep"),
        _sep(),

        _noop("ğŸ“Œ CHOCH â€” Change of Character"),
        _noop("   Ğ¡Ğ¼ĞµĞ½Ğ° Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹. Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ñ€Ğ°Ğ½Ğ½Ğ¸Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ»"),
        _noop("   Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ° â€” ĞµÑ‰Ñ‘ Ğ´Ğ¾ BOS. Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ², Ğ¼ĞµĞ½ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹."),
        _btn(_check(cfg.smc_use_choch) + "  CHOCH â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "smc_toggle_choch"),
        _sep(),

        _noop("ğŸ“Œ Daily Confluence"),
        _noop("   Ğ¡Ğ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ Ğ·Ğ¾Ğ½Ñ‹ Ğ²Ñ…Ğ¾Ğ´Ğ° Ñ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¼ Ğ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ³Ğ¾ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°"),
        _noop("   (Pivot Points, Camarilla). Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ."),
        _btn(_check(cfg.smc_use_conf) + "  Daily Confluence â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "smc_toggle_conf"),

        _sep(),
        _back(back_cb),
    ]
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_smc(user: UserSettings)       -> InlineKeyboardMarkup: return _smc_kb(user.shared_cfg(),    "",       "menu_settings")
def kb_long_smc(user: UserSettings)  -> InlineKeyboardMarkup: return _smc_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_smc(user: UserSettings) -> InlineKeyboardMarkup: return _smc_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ĞŸĞ˜Ğ’ĞĞ¢Ğ«
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _pivots_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("ğŸ“ ĞŸĞ˜Ğ’ĞĞ¢Ğ« Ğ˜ Ğ£Ğ ĞĞ’ĞĞ˜ S/R â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _sep(),

        _noop("Ğ§ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ğ¾Ğ²"),
        _noop("   Ğ§ĞµĞ¼ Ğ²Ñ‹ÑˆĞµ â€” Ñ‚ĞµĞ¼ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ğ¾Ğ², Ğ½Ğ¾ Ğ¾Ğ½Ğ¸ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½ĞµĞµ."),
        _noop("   Ğ§ĞµĞ¼ Ğ½Ğ¸Ğ¶Ğµ â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹, Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ ÑĞºĞ°Ğ»ÑŒĞ¿Ğ¸Ğ½Ğ³Ğ°."),
    ]
    for v, d in [
        (3,  "3  â€” Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ (ÑĞºĞ°Ğ»ÑŒĞ¿)"),
        (5,  "5  â€” ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾"),
        (7,  "7  â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (10, "10 â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸"),
        (15, "15 â€” ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ"),
    ]:
        rows.append(_btn(_mark(cfg.pivot_strength, v) + d, p + "set_pivot_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞœĞ°ĞºÑ. Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (ÑĞ²ĞµÑ‡ĞµĞ¹)"),
        _noop("   Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ²ĞµÑ‡ĞµĞ¹ Ğ½Ğ°Ğ·Ğ°Ğ´ Ğ¼Ñ‹ Ğ¸Ñ‰ĞµĞ¼ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸."),
        _noop("   Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ Ğ¼ĞµĞ½ĞµĞµ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹, Ğ½Ğ¾ Ğ±Ñ‹Ğ²Ğ°ÑÑ‚ Ğ²Ğ°Ğ¶Ğ½Ñ‹."),
    ]
    for v, d in [
        (50,  "50  ÑĞ²ĞµÑ‡ĞµĞ¹ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²ĞµĞ¶Ğ¸Ğµ"),
        (100, "100 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (150, "150 ÑĞ²ĞµÑ‡ĞµĞ¹"),
        (200, "200 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ"),
    ]:
        rows.append(_btn(_mark(cfg.max_level_age, v) + d, p + "set_age_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞœĞ°ĞºÑ. Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµÑ‚ĞµÑÑ‚Ğ° (ÑĞ²ĞµÑ‡ĞµĞ¹)"),
        _noop("   Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ²ĞµÑ‡ĞµĞ¹ Ğ¶Ğ´Ñ‘Ğ¼ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ†ĞµĞ½Ñ‹ Ğº Ğ·Ğ¾Ğ½Ğµ."),
    ]
    for v, d in [
        (10, "10 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹"),
        (20, "20 ÑĞ²ĞµÑ‡ĞµĞ¹"),
        (30, "30 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (50, "50 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” Ğ´Ğ¾Ğ»Ğ³Ğ¾Ğµ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ"),
    ]:
        rows.append(_btn(_mark(cfg.max_retest_bars, v) + d, p + "set_retest_" + str(v)))

    rows += [
        _sep(),
        _noop("Ğ‘ÑƒÑ„ĞµÑ€ Ğ·Ğ¾Ğ½Ñ‹ (Ã— ATR)"),
        _noop("   Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ·Ğ¾Ğ½Ñ‹ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ."),
        _noop("   Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ğ±ÑƒÑ„ĞµÑ€ â€” Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ€ĞµÑ‚ĞµÑÑ‚Ğ¾Ğ², Ğ½Ğ¾ ÑˆĞ¸Ñ€Ğµ Ğ·Ğ¾Ğ½Ğ°."),
    ]
    for v, d in [
        (0.1, "Ã—0.1 â€” Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´"),
        (0.2, "Ã—0.2 â€” Ñ‚ĞµÑĞ½Ñ‹Ğ¹"),
        (0.3, "Ã—0.3 â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (0.5, "Ã—0.5 â€” ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹"),
    ]:
        rows.append(_btn(_mark(cfg.zone_buffer, v) + str(v) + " â€” " + d, p + "set_buffer_" + str(v)))

    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_pivots(user: UserSettings)       -> InlineKeyboardMarkup: return _pivots_kb(user.shared_cfg(),    "",       "menu_settings")
def kb_long_pivots(user: UserSettings)  -> InlineKeyboardMarkup: return _pivots_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_pivots(user: UserSettings) -> InlineKeyboardMarkup: return _pivots_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  EMA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _ema_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("ğŸ“‰ EMA Ğ¢Ğ Ğ•ĞĞ” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _sep(),

        _noop("Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ EMA â€” ĞºÑ€Ğ°Ñ‚ĞºĞ¾ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´"),
        _noop("   ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ñ‚Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼Ğµ."),
        _noop("   Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ğ²Ñ‹Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñƒ EMA fast."),
    ]
    for v, d in [
        (20,  "EMA 20  â€” Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ñ€ĞµĞ°Ğ³Ğ¸Ñ€ÑƒĞµÑ‚"),
        (50,  "EMA 50  â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (100, "EMA 100 â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ, Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ñ…"),
    ]:
        rows.append(_btn(_mark(cfg.ema_fast, v) + d, p + "set_ema_fast_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ EMA â€” Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´"),
        _noop("   Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ñ„Ğ¾Ğ½Ğ°: Ñ†ĞµĞ½Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ñ‹ÑˆĞµ/Ğ½Ğ¸Ğ¶Ğµ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹ EMA."),
    ]
    for v, d in [
        (100, "EMA 100 â€” ÑÑ€ĞµĞ´Ğ½ĞµÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğ¹"),
        (200, "EMA 200 â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹"),
        (500, "EMA 500 â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ñ‰Ğ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´"),
    ]:
        rows.append(_btn(_mark(cfg.ema_slow, v) + d, p + "set_ema_slow_" + str(v)))

    rows += [
        _sep(),
        _noop("HTF EMA â€” EMA Ğ½Ğ° ÑÑ‚Ğ°Ñ€ÑˆĞµĞ¼ Ñ‚Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼Ğµ"),
        _noop("   Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ HTF Ñ‚Ñ€ĞµĞ½Ğ´Ğ°."),
        _noop("   Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ñ†ĞµĞ½Ğ° Ğ½Ğ° ÑÑ‚Ğ°Ñ€ÑˆĞµĞ¼ TF Ğ¿Ğ¾ Ñ‚Ñ€ĞµĞ½Ğ´Ñƒ."),
    ]
    for v, d in [
        (20,  "EMA 20  â€” Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ HTF"),
        (50,  "EMA 50  â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (100, "EMA 100 â€” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ HTF"),
        (200, "EMA 200 â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´ D1"),
    ]:
        rows.append(_btn(_mark(cfg.htf_ema_period, v) + "HTF " + d, p + "set_htf_ema_" + str(v)))

    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_ema(user: UserSettings)       -> InlineKeyboardMarkup: return _ema_kb(user.shared_cfg(),    "",       "menu_settings")
def kb_long_ema(user: UserSettings)  -> InlineKeyboardMarkup: return _ema_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_ema(user: UserSettings) -> InlineKeyboardMarkup: return _ema_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ Ğ«
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _filters_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("ğŸ”¬ Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ Ğ« Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ ÑĞ½Ğ¸Ğ¶Ğ°ĞµÑ‚ ĞºĞ¾Ğ»-Ğ²Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ², Ğ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ."),
        _sep(),

        _noop("RSI Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€"),
        _noop("   ĞÑ‚ÑĞµĞºĞ°ĞµÑ‚ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ ĞºĞ¾Ğ³Ğ´Ğ° RSI Ğ² Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ğµ."),
        _noop("   Ğ”Ğ»Ñ Ğ›ĞĞĞ“: RSI Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ¸Ğ¶Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¿ĞµÑ€ĞµĞºÑƒĞ¿Ğ»ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸."),
        _noop("   Ğ”Ğ»Ñ Ğ¨ĞĞ Ğ¢: RSI Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ñ‹ÑˆĞµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¿ĞµÑ€ĞµĞ¿Ñ€Ğ¾Ğ´Ğ°Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸."),
        _btn(_check(cfg.use_rsi) + "  RSI Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "toggle_rsi"),
        _sep(),

        _noop("Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ°"),
        _noop("   Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ²Ñ‹ÑˆĞµ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ã— Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ."),
        _noop("   Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¾Ğ±ÑŠÑ‘Ğ¼ = ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğ¹ Ğ¸Ğ³Ñ€Ğ¾Ğº ÑƒÑ‡Ğ°ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸."),
        _btn(_check(cfg.use_volume) + "  Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ° â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "toggle_volume"),
        _sep(),

        _noop("Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²"),
        _noop("   Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ÑĞ²ĞµÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ° Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°."),
        _noop("   ĞŸĞ¸Ğ½-Ğ±Ğ°Ñ€, Ğ¿Ğ¾Ğ³Ğ»Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ, Ğ¼Ğ¾Ğ»Ğ¾Ñ‚, Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ°Ñ Ğ·Ğ²ĞµĞ·Ğ´Ğ°."),
        _btn(_check(cfg.use_pattern) + "  ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "toggle_pattern"),
        _sep(),

        _noop("HTF Ñ‚Ñ€ĞµĞ½Ğ´ (ÑÑ‚Ğ°Ñ€ÑˆĞ¸Ğ¹ Ñ‚Ğ°Ğ¹Ğ¼Ñ„Ñ€ĞµĞ¹Ğ¼)"),
        _noop("   Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ½Ğ° ÑÑ‚Ğ°Ñ€ÑˆĞµĞ¼ TF (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ D1) Ñ‚Ñ€ĞµĞ½Ğ´"),
        _noop("   ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ñ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°. ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² EMA."),
        _btn(_check(cfg.use_htf) + "  HTF Ñ‚Ñ€ĞµĞ½Ğ´ â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "toggle_htf"),
        _sep(),

        _noop("ĞŸÑ€Ğ°Ğ¹Ğ¼-ÑĞµÑÑĞ¸Ğ¸"),
        _noop("   Ğ›Ğ¾Ğ½Ğ´Ğ¾Ğ½ 07:00â€“10:00 UTC Ğ¸ ĞÑŒÑ-Ğ™Ğ¾Ñ€Ğº 13:00â€“17:00 UTC."),
        _noop("   Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ¸ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹. ĞĞ·Ğ¸Ñ â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞº."),
        _btn(_check(cfg.use_session) + "  ĞŸÑ€Ğ°Ğ¹Ğ¼-ÑĞµÑÑĞ¸Ğ¸ â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", p + "toggle_session"),
        _sep(),

        _noop("â”€â”€ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ RSI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ RSI â€” Ñ‡ĞµĞ¼ Ğ¼ĞµĞ½ÑŒÑˆĞµ, Ñ‚ĞµĞ¼ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ñ€ĞµĞ°Ğ³Ğ¸Ñ€ÑƒĞµÑ‚"),
    ]
    for v, d in [
        (7,  "RSI 7  â€” ÑĞºĞ°Ğ»ÑŒĞ¿Ğ¸Ğ½Ğ³"),
        (14, "RSI 14 â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (21, "RSI 21 â€” ÑĞ²Ğ¸Ğ½Ğ³"),
    ]:
        rows.append(_btn(_mark(cfg.rsi_period, v) + d, p + "set_rsi_period_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞŸĞµÑ€ĞµĞºÑƒĞ¿Ğ»ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ RSI â€” Ğ¨ĞĞ Ğ¢: Ğ¿Ñ€Ğ¾Ğ´Ğ°Ñ‘Ğ¼ ĞºĞ¾Ğ³Ğ´Ğ° RSI Ğ²Ñ‹ÑˆĞµ"),
    ]
    for v in [60, 65, 70, 75]:
        rows.append(_btn(_mark(cfg.rsi_ob, v) + "RSI OB: " + str(v), p + "set_rsi_ob_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞŸĞµÑ€ĞµĞ¿Ñ€Ğ¾Ğ´Ğ°Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ RSI â€” Ğ›ĞĞĞ“: Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°ĞµĞ¼ ĞºĞ¾Ğ³Ğ´Ğ° RSI Ğ½Ğ¸Ğ¶Ğµ"),
    ]
    for v in [25, 30, 35, 40]:
        rows.append(_btn(_mark(cfg.rsi_os, v) + "RSI OS: " + str(v), p + "set_rsi_os_" + str(v)))

    rows += [
        _sep(),
        _noop("â”€â”€ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ° â€” ÑĞ¸Ğ³Ğ½Ğ°Ğ» ĞµÑĞ»Ğ¸ Ğ¾Ğ±ÑŠÑ‘Ğ¼ â‰¥ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ã— N"),
        _noop("Ğ§ĞµĞ¼ Ğ²Ñ‹ÑˆĞµ â€” Ñ‚ĞµĞ¼ Ñ€ĞµĞ¶Ğµ Ğ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½ĞµĞµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹."),
    ]
    for v, d in [
        (1.0, "Ã—1.0 â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¾Ğ±ÑŠÑ‘Ğ¼"),
        (1.2, "Ã—1.2 â€” Ñ‡ÑƒÑ‚ÑŒ Ğ²Ñ‹ÑˆĞµ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ â­"),
        (1.5, "Ã—1.5 â€” Ğ·Ğ°Ğ¼ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº"),
        (2.0, "Ã—2.0 â€” ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº"),
    ]:
        rows.append(_btn(_mark(cfg.vol_mult, v) + d, p + "set_vol_mult_" + str(v)))

    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_filters(user: UserSettings)       -> InlineKeyboardMarkup: return _filters_kb(user.shared_cfg(),    "",       "menu_settings")
def kb_long_filters(user: UserSettings)  -> InlineKeyboardMarkup: return _filters_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_filters(user: UserSettings) -> InlineKeyboardMarkup: return _filters_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ĞšĞĞ§Ğ•Ğ¡Ğ¢Ğ’Ğ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _quality_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("â­ ĞœĞ˜ĞĞ˜ĞœĞĞ›Ğ¬ĞĞĞ• ĞšĞĞ§Ğ•Ğ¡Ğ¢Ğ’Ğ Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ½Ğ°Ğ±Ñ€Ğ°Ğ» Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ ĞºĞ¾Ğ»-Ğ²Ğ¾ Ğ·Ğ²Ñ‘Ğ·Ğ´."),
        _noop("   Ğ—Ğ²Ñ‘Ğ·Ğ´Ñ‹ = ÑĞ¾Ğ²Ğ¿Ğ°Ğ²ÑˆĞ¸Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ (Ğ¾Ğ±ÑŠÑ‘Ğ¼, Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½, Ñ‚Ñ€ĞµĞ½Ğ´ Ğ¸ Ğ´Ñ€.)."),
        _sep(),
    ]
    for q, d in [
        (1, "â­          â€” Ğ²ÑĞµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹, Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑˆÑƒĞ¼Ğ°"),
        (2, "â­â­        â€” ÑĞ»Ğ°Ğ±Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ"),
        (3, "â­â­â­      â€” Ğ±Ğ°Ğ»Ğ°Ğ½Ñ â­ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ"),
        (4, "â­â­â­â­    â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹, Ğ¼Ğ°Ğ»Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²"),
        (5, "â­â­â­â­â­  â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ"),
    ]:
        rows.append(_btn(_mark(cfg.min_quality, q) + d, p + "set_quality_" + str(q)))
    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_quality(cur: int)              -> InlineKeyboardMarkup:
    cfg = TradeCfg(min_quality=cur); return _quality_kb(cfg, "", "menu_settings")
def kb_long_quality(user: UserSettings)  -> InlineKeyboardMarkup: return _quality_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_quality(user: UserSettings) -> InlineKeyboardMarkup: return _quality_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  COOLDOWN
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _cooldown_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("ğŸ” COOLDOWN â€” ĞŸĞĞ£Ğ—Ğ ĞœĞ•Ğ–Ğ”Ğ£ Ğ¡Ğ˜Ğ“ĞĞĞ›ĞĞœĞ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   ĞŸĞ¾ÑĞ»Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ° Ğ¿Ğ¾ Ğ¼Ğ¾Ğ½ĞµÑ‚Ğµ â€” ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ½Ğµ Ñ€Ğ°Ğ½ÑŒÑˆĞµ Ñ‡ĞµĞ¼"),
        _noop("   Ñ‡ĞµÑ€ĞµĞ· N ÑĞ²ĞµÑ‡ĞµĞ¹. Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ´ÑƒĞ±Ğ»ĞµĞ¹ Ğ¸ Ğ¿ĞµÑ€ĞµĞ³Ñ€ĞµĞ²Ğ°."),
        _sep(),
    ]
    for v, d in [
        (3,  "3 ÑĞ²ĞµÑ‡Ğ¸  â€” Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ±ĞµĞ· Ğ¿Ğ°ÑƒĞ·Ñ‹ (ÑĞºĞ°Ğ»ÑŒĞ¿)"),
        (5,  "5 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (10, "10 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾"),
        (15, "15 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹"),
        (20, "20 ÑĞ²ĞµÑ‡ĞµĞ¹ â€” Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ€ĞµĞ´ĞºĞ¾"),
    ]:
        rows.append(_btn(_mark(cfg.cooldown_bars, v) + d, p + "set_cooldown_" + str(v)))
    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_cooldown(cur: int)              -> InlineKeyboardMarkup:
    cfg = TradeCfg(cooldown_bars=cur); return _cooldown_kb(cfg, "", "menu_settings")
def kb_long_cooldown(user: UserSettings)  -> InlineKeyboardMarkup: return _cooldown_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_cooldown(user: UserSettings) -> InlineKeyboardMarkup: return _cooldown_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ¡Ğ¢ĞĞŸ-Ğ›ĞĞ¡Ğ¡ (ATR)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _sl_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("ğŸ›¡ Ğ¡Ğ¢ĞĞŸ-Ğ›ĞĞ¡Ğ¡ (ATR) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   SL = ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ²Ñ…Ğ¾Ğ´Ğ° Â± ATR Ã— Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ."),
        _noop("   ATR (Average True Range) = ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½ ÑĞ²ĞµÑ‡Ğ¸."),
        _sep(),

        _noop("ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ ATR â€” Ğ·Ğ° ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ²ĞµÑ‡ĞµĞ¹ ÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ"),
        _noop("   ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ â€” Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ñ€ĞµĞ°Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ° Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ¸."),
        _noop("   Ğ”Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ â€” Ğ±Ğ¾Ğ»ĞµĞµ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ğ¾Ğ¿."),
    ]
    for v, d in [
        (7,  "ATR 7  â€” Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹"),
        (14, "ATR 14 â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (21, "ATR 21 â€” ÑĞ³Ğ»Ğ°Ğ¶ĞµĞ½Ğ½Ñ‹Ğ¹"),
    ]:
        rows.append(_btn(_mark(cfg.atr_period, v) + d, p + "set_atr_period_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ ATR â€” Ğ½Ğ°ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿"),
        _noop("   Ã—0.5 = Ñ‚ĞµÑĞ½Ñ‹Ğ¹ ÑÑ‚Ğ¾Ğ¿, Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ R:R, Ğ½Ğ¾ Ñ‡Ğ°Ñ‰Ğµ Ğ²Ñ‹Ğ½Ğ¾ÑĞ¸Ñ‚."),
        _noop("   Ã—2.0 = ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿, Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ²Ñ‹Ğ½Ğ¾ÑĞ¾Ğ², Ñ…ÑƒĞ¶Ğµ R:R."),
    ]
    for v, d in [
        (0.5, "Ã—0.5 â€” Ñ‚ĞµÑĞ½Ñ‹Ğ¹ (Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ²Ñ‹Ğ½Ğ¾ÑĞ¾Ğ²)"),
        (1.0, "Ã—1.0 â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (1.5, "Ã—1.5 â€” ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹"),
        (2.0, "Ã—2.0 â€” Ğ¾Ñ‡ĞµĞ½ÑŒ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹"),
    ]:
        rows.append(_btn(_mark(cfg.atr_mult, v) + d, p + "set_atr_mult_" + str(v)))

    rows += [
        _sep(),
        _noop("ĞœĞ°ĞºÑ. Ñ€Ğ¸ÑĞº Ğ½Ğ° ÑĞ´ĞµĞ»ĞºÑƒ (% Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ°)"),
        _noop("   ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ¾Ğ¿ ĞµÑĞ»Ğ¸ ATR Ğ´Ğ°Ñ‘Ñ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹."),
        _noop("   Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ 1â€“2% Ğ½Ğ° ÑĞ´ĞµĞ»ĞºÑƒ."),
    ]
    for v, d in [
        (0.5, "0.5% â€” ĞºĞ¾Ğ½ÑĞµÑ€Ğ²Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾"),
        (1.0, "1.0% â€” ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾"),
        (1.5, "1.5% â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­"),
        (2.0, "2.0% â€” Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾"),
        (3.0, "3.0% â€” Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº"),
    ]:
        rows.append(_btn(_mark(cfg.max_risk_pct, v) + d, p + "set_risk_" + str(v)))

    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_sl(user: UserSettings)       -> InlineKeyboardMarkup: return _sl_kb(user.shared_cfg(),    "",       "menu_settings")
def kb_long_sl(user: UserSettings)  -> InlineKeyboardMarkup: return _sl_kb(user.get_long_cfg(),  "long_",  "mode_long")
def kb_short_sl(user: UserSettings) -> InlineKeyboardMarkup: return _sl_kb(user.get_short_cfg(), "short_", "mode_short")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ¦Ğ•Ğ›Ğ˜ (TP)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def kb_targets(user: UserSettings) -> InlineKeyboardMarkup:
    cfg = user.shared_cfg()
    return InlineKeyboardMarkup(inline_keyboard=[
        _noop("ğŸ¯ TAKE PROFIT â€” Ğ¦Ğ•Ğ›Ğ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   TP = Ñ€Ğ¸ÑĞº Ã— R. ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ñ€Ğ¸ÑĞº 100$ Ã— 2R = TP +200$."),
        _noop("   Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ: Ğ¦ĞµĞ»ÑŒ 1 = 1â€“1.5R, Ğ¦ĞµĞ»ÑŒ 2 = 2â€“3R, Ğ¦ĞµĞ»ÑŒ 3 = 3â€“5R."),
        _sep(),
        _btn("ğŸ¯ Ğ¦ĞµĞ»ÑŒ 1: " + str(cfg.tp1_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_tp1"),
        _btn("ğŸ¯ Ğ¦ĞµĞ»ÑŒ 2: " + str(cfg.tp2_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_tp2"),
        _btn("ğŸ† Ğ¦ĞµĞ»ÑŒ 3: " + str(cfg.tp3_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_tp3"),
        _back("menu_settings"),
    ])

def kb_long_targets(user: UserSettings) -> InlineKeyboardMarkup:
    cfg = user.get_long_cfg()
    return InlineKeyboardMarkup(inline_keyboard=[
        _noop("ğŸ¯ TAKE PROFIT Ğ›ĞĞĞ“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   TP = Ñ€Ğ¸ÑĞº Ã— R. Ğ¦ĞµĞ»ÑŒ 1 = 1R, Ğ¦ĞµĞ»ÑŒ 2 = 2R, Ğ¦ĞµĞ»ÑŒ 3 = 3R."),
        _sep(),
        _btn("ğŸ¯ Ğ¦ĞµĞ»ÑŒ 1: " + str(cfg.tp1_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_long_tp1"),
        _btn("ğŸ¯ Ğ¦ĞµĞ»ÑŒ 2: " + str(cfg.tp2_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_long_tp2"),
        _btn("ğŸ† Ğ¦ĞµĞ»ÑŒ 3: " + str(cfg.tp3_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_long_tp3"),
        _back("mode_long"),
    ])

def kb_short_targets(user: UserSettings) -> InlineKeyboardMarkup:
    cfg = user.get_short_cfg()
    return InlineKeyboardMarkup(inline_keyboard=[
        _noop("ğŸ¯ TAKE PROFIT Ğ¨ĞĞ Ğ¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   TP = Ñ€Ğ¸ÑĞº Ã— R. Ğ¦ĞµĞ»ÑŒ 1 = 1R, Ğ¦ĞµĞ»ÑŒ 2 = 2R, Ğ¦ĞµĞ»ÑŒ 3 = 3R."),
        _sep(),
        _btn("ğŸ¯ Ğ¦ĞµĞ»ÑŒ 1: " + str(cfg.tp1_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_short_tp1"),
        _btn("ğŸ¯ Ğ¦ĞµĞ»ÑŒ 2: " + str(cfg.tp2_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_short_tp2"),
        _btn("ğŸ† Ğ¦ĞµĞ»ÑŒ 3: " + str(cfg.tp3_rr) + "R â€” Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", "edit_short_tp3"),
        _back("mode_short"),
    ])


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ĞĞ‘ĞªĞĞœ ĞœĞĞĞ•Ğ¢
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def _volume_kb(cfg: TradeCfg, prefix: str, back_cb: str) -> InlineKeyboardMarkup:
    p = prefix
    rows = [
        _noop("ğŸ’° Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ  ĞœĞĞĞ•Ğ¢ ĞŸĞ ĞĞ‘ĞªĞĞœĞ£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _noop("   ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ¼Ğ¾Ğ½ĞµÑ‚Ñ‹ Ğ² USDT."),
        _noop("   ĞœĞ°Ğ»Ğ¾ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ° = Ğ½ĞµĞ»Ğ¸ĞºĞ²Ğ¸Ğ´, Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ ÑĞ¿Ñ€ĞµĞ´Ñ‹, Ğ¼Ğ°Ğ½Ğ¸Ğ¿ÑƒĞ»ÑÑ†Ğ¸Ğ¸."),
        _sep(),
    ]
    for v, d in [
        (100_000,    "100K$  â€” Ğ°Ğ»ÑŒÑ‚ĞºĞ¾Ğ¸Ğ½Ñ‹, Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº"),
        (500_000,    "500K$  â€” Ğ¼Ğ°Ğ»Ğ°Ñ Ğ»Ğ¸ĞºĞ²Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ"),
        (1_000_000,  "1M$    â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ â­ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ»Ğ¸ĞºĞ²Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ"),
        (5_000_000,  "5M$    â€” Ñ‚Ğ¾Ğ¿Ğ¾Ğ²Ñ‹Ğµ Ğ°Ğ»ÑŒÑ‚ĞºĞ¾Ğ¸Ğ½Ñ‹"),
        (10_000_000, "10M$   â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ"),
        (50_000_000, "50M$   â€” BTC, ETH, Ñ‚Ğ¾Ğ¿-10"),
    ]:
        rows.append(_btn(_mark(cfg.min_volume_usdt, float(v)) + d, p + "set_volume_" + str(int(v))))
    rows.append(_back(back_cb))
    return InlineKeyboardMarkup(inline_keyboard=rows)

def kb_volume(cur: float)              -> InlineKeyboardMarkup:
    cfg = TradeCfg(min_volume_usdt=cur); return _volume_kb(cfg, "", "menu_settings")
def kb_long_volume(user: UserSettings)  -> InlineKeyboardMarkup: return _volume_kb(user.get_long_cfg(),  "long_",  "menu_long_settings")
def kb_short_volume(user: UserSettings) -> InlineKeyboardMarkup: return _volume_kb(user.get_short_cfg(), "short_", "menu_short_settings")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ¯
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def kb_notify(user: UserSettings) -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=[
        _noop("ğŸ“± Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),
        _sep(),
        _noop("Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ğ²Ñ…Ğ¾Ğ´Ğ°"),
        _noop("   ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ»: Ğ²Ñ…Ğ¾Ğ´, ÑÑ‚Ğ¾Ğ¿, Ñ‚Ñ€Ğ¸ Ñ†ĞµĞ»Ğ¸, Ñ‡ĞµĞºĞ»Ğ¸ÑÑ‚ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹."),
        _btn(_check(user.notify_signal) + "  Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ğ²Ñ…Ğ¾Ğ´Ğ° â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", "toggle_notify_signal"),
        _sep(),
        _noop("ĞŸÑ€Ğ¾Ğ±Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ"),
        _noop("   Ğ Ğ°Ğ½Ğ½Ğ¸Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ» â€” Ñ†ĞµĞ½Ğ° Ğ¿Ñ€Ğ¾Ğ±Ğ¸Ğ»Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ. Ğ‘ĞµĞ· TP/SL."),
        _noop("   ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ¼."),
        _btn(_check(user.notify_breakout) + "  ĞŸÑ€Ğ¾Ğ±Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ â€” Ğ²ĞºĞ»/Ğ²Ñ‹ĞºĞ»", "toggle_notify_breakout"),
        _back("menu_settings"),
    ])


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Ğ’Ğ¡ĞŸĞĞœĞĞ“ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ•
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def kb_back()          -> InlineKeyboardMarkup: return InlineKeyboardMarkup(inline_keyboard=[_back()])
def kb_back_settings() -> InlineKeyboardMarkup: return InlineKeyboardMarkup(inline_keyboard=[_back("menu_settings")])

def kb_subscribe(config) -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=[
        _btn("ğŸ’³ 30 Ğ´Ğ½ĞµĞ¹ â€” " + config.PRICE_30_DAYS,  "buy_30"),
        _btn("ğŸ’³ 90 Ğ´Ğ½ĞµĞ¹ â€” " + config.PRICE_90_DAYS,  "buy_90"),
        _btn("ğŸ’³ 365 Ğ´Ğ½ĞµĞ¹ â€” " + config.PRICE_365_DAYS, "buy_365"),
        _btn("ğŸ“© ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ",              "contact_admin"),
    ])
